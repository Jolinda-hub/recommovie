{% extends "layout.html" %}
{% block navbar %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="#">Recommovie</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <form class="form-inline" action="javascript:">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search" name="info"
                   id="selector">
        </form>

        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Contact</a>
                </li>
            </ul>
        </div>
    </div>
</nav>
{% endblock %}

{% block script %}
<script>
    var tags = new Bloodhound({
        datumTokenizer: Bloodhound.tokenizers.whitespace,
        queryTokenizer: Bloodhound.tokenizers.whitespace,
        remote: {
            url: '/suggest?movie_id=%QUERY',
            wildcard: '%QUERY',
            filter: function (response) {
                if (!response.status) {
                    return
                }

                return $.map(response.movies, function (movie) {
                    return movie;
                });
            }
        }
    });


    $("#selector").typeahead({
            hint: true,
            highlight: true,
            minLength: 1
        },
        {
            name: 'movies',
            display: 'text',
            source: tags,
            templates: {
                empty: 'no any records',
                suggestion: function (data) {
                    return '<div><div>' + data.text + '</div><div class="gray">' + data.value + '</div></div>';
                },
            },
        }
    ).bind('typeahead:select', function (ev, suggestion) {
        window.location.href = '/recommendations/' + suggestion.id.toString();
        ev.preventDefault();
    })
</script>
{% endblock %}